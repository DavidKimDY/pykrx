# PyKrx

본 모듈은 KRX (<http://marketdata.krx.co.kr>) 웹 싸이트를 스크래핑 (scraping) 합니다. 
API 사용에 대한 KRX 관리자의 허락을 받지 않은 상태로, API 사용에 대한 책임은 사용자 본인에게 있습니다. 웹싸이트의 스크래핑으로 자신의 영업에 무단 사용하는 것은 불법이기 때문에 개인적인 용도로 사용하셔야 합니다. 또한 도의적으로도 무분별한 API 호출은 자제해 주시기 부탁드립니다.    
결과물은 참고용으로만 사용해야하며, 투자의 결과에 대한 책임은 사용자에게 있습니다. 개인 Study를 진행하며 정리한 내용으로 잘못된 내용이 있을 수 있습니다.  

## 1 환경설정

### 1.1 Installation
pykrx는 pip을 사용해서 쉽게 설치할 수 있습니다. 

```
pip install pykrx
```

### 1.2 Import
모듈의 사용은 import 부터 시작합니다.
<code>from pykrx import Krx</code>

### 1.3 객체 생성
클래스로 구현되어 있으며, 클래스 객체를 통해 모든 API에 접근할 수있습니다.
```python
krx = Krx()
```
정상적으로 설치가 됐다면 아래 코드가 에러없이 실행됩니다.

```python
krx.get_tickers()
```
###### 실행결과 
```
['060310', '095570', '068400', '006840', '054620', ...]
```        

<br/>

## 2. API 설명

### 2.1 MarketData API

#### 2.1.1 Ticker 
get_tickers() 메서드는 전종목의 ticker를 리스트로 반환합니다.

```python
df = krx.get_tickers()
print(df)
```

```text
['060310', '095570', '068400', '006840', '054620', ...]
```

#### 2.1.2 종목별 OHLCV
get_market_ohlcv() 메서드는 시작일/종료일/티커 세 개의 파라미터를 입력받아 OHLCV를 DataFrame으로 반환합니다.

```python
df = krx.get_market_ohlcv("20181210", "20181212", "005930")
```

```text
               시가   고가    저가   종가    거래량
KR7005930003                                      
2018/12/12    40250  40700  40150  40450  12024279
2018/12/11    40600  40700  40200  40250  10638766
2018/12/10    40450  40650  40000  40200  14892263
```

get_tickers() 메서드와 함께 사용하면 전종목의 OHLCV를 가져올 수 있습니다.
```python
for ticker in krx.get_tickers():
    df = krx.get_market_ohlcv("20181210", "20181212", ticker)
    print(df)
    time.sleep(1)
```


### 2.2 공매도 API
KRX는 (T+2)일 이후의 데이터를 제공합니다. 오늘 날짜가 2018/12/14라면 2018/12/12일 포함한 이전 데이터를 얻을 수 있습니다. 

#### 2.2.1 종목별 공매도 현황 

get_shorting_status_by_date() 메서드는 시작일/종료일/티커 세 개의 파라미터를 입력받아 공매도 현황을 DataFrame으로 반환합니다. 
 
 ```python
df = krx.get_shorting_status_by_date("20181210", "20181212", "005930")
print(df)
```
상환량은 KRX가 제공하지 않으나 잔고와 거래량을 사용해서 계산한 값입니다.
당일 잔고와 (전일 잔고 + 당일 공매도 - 당일 상환) 수량은 정확하게 일치하지 않을 수 있습니다. 
이는 투자자가 보유한 공매도잔고 비율이 상장주식수의 0.01% 미만인 경우 보고의 의무가 없기 때문에 집계되지 않기습니다.  
```text
              공매도     잔고     상환    공매도금액     잔고금액   
삼성전자                                                            
2018/12/12    40002    53032  4236519   1618884450  171367193550
2018/12/11   701924  1180702  4249549  28291624600  171044347250
2018/12/10  2180611        0  4728327  87700923850  190078745400
```

#### 2.2.2 종목별 공매도 거래 현황
get_shorting_volume_by_ticker() 메서드는 시작일/종료일 두 개의 파라미터를 입력받아 해당 기간동안 코스피 종목의 공매도 거래량 정보를 DataFrame으로 반환합니다.


  ```python
df = krx.get_shorting_volume_by_ticker("20181212", "20181212")
print(df)
```
```text
                          종목명    공매도수량  총거래량  거래량비중
코스피(20181212-20181212)                                
2018/12/07                AJ네트웍스      0     26746     0.00
2018/12/07                 AJ렌터카    6901    497586     1.39
```
market 옵션을 사용하면 코스닥의 공매도 거래량을 조회할 수 있습니다. 사용하지 않을 경우 코스피가 선택됩니다. 
 ```python
df = krx.get_shorting_volume_by_ticker("20181212", "20181212", market="코스닥")
print(df)
```
ticker 옵션을 사용하면 특정 종목의 기간 거래량을 조회할 수 있습니다. 사용하지 않을 경우 전체 종목의 거래량을 조회합니다. 
 ```python
df = krx.get_shorting_volume_by_ticker("20181205", "20181212", ticker="005930")
print(df)
```

조회 속도는 조회 기간에 비례해서 증가합니다. (내부적으로 500개씩 데이터를 조회하며, 각각의 조회 후 0.3초 delay 됩니다.)


#### 2.2.3 투자자별 공매도 거래 현황
get_shorting_investor_by_date() 메서드는 시작일/종료일 두 개의 파라미터를 입력받아 해당 기간동안 코스피 종목의 투자자별 공매도 거래량/거래대금을 DataFrame으로 반환합니다.

```python
df = krx.get_shorting_volume_by_investor("20181207", "20181212")
print(df)
```

```text
              기관     개인    외국인    기타    합계
거래량-코스피                                              
2018/12/12  1518171  230146  5927886      0   7676203
2018/12/11  1682098  189059  7588421      0   9459578
2018/12/10  2295282  170803  9048100   1415  11515600
2018/12/07  1835771  155753  6126814      0   8118338
```

market 옵션을 사용하면 코스닥의 공매도 거래량을 조회할 수 있습니다. 사용하지 않을 경우 코스피가 선택됩니다. 
 ```python
df = krx.get_shorting_volume_by_investor("20181212", "20181212", market="코스닥")
print(df)
```
inquery 옵션을 사용하면 거래대금/거래량을 선택할 수 있습니다. 사용하지 않을 경우 거래량이 선택됩니다. 
 ```python
df = krx.get_shorting_volume_by_investor("20181205", "20181212", inquery="거래대금")
print(df)
```

#### 2.2.4 공매도 거래비중 상위 50 종목
get_shorting_trade_top50() 메서드는 조회일자를 입력받아 해당일 코스피 종목의 거래 비중 TOP 50을 DataFrame으로 반환합니다.

```python
df = krx.get_shorting_volume_top50("20181207", "20181212")
print(df)
```

```text
               순위  공매도거래대금  총거래대금  공매도비중   40일대금평균  대금증가율  40일평균비중 비중증가율  주가수익률
코스피(20181212)                                                                                               
동양생명          1    304432100    454540230   66.976      62246523     4.891       11.882     5.637     1.512
한국토지신탁      2    107461215     319262830   33.659     55167704     1.948        6.994     4.812     1.616
SK디스커버리      3    299738350    1001550500   29.927     70720848     4.238        5.396     5.546     2.679
```

market 옵션을 사용하면 코스닥의 공매도 거래량을 조회할 수 있습니다. 사용하지 않을 경우 코스피가 선택됩니다. 
 ```python
df = krx.get_shorting_volume_top50("20181207", "20181212", market="코스닥")
```

#### 2.2.5 종목별 공매도 잔고 현황
get_shorting_balance_by_ticker() 메서드는 시작일/종료일 두 개의 파라미터를 입력받아 해당 기간동안 공매도 잔고 정보를 DataFrame으로 반환합니다. 내부적으로 


```python
df = krx.get_shorting_balance_by_ticker("20181207", "20181212")
print(df)
```

```text
                               종목명    공매도잔고 상장주식수   공매도금액         시가총액    비중
코스피 (20181212-20181212)                                                                    
2018/12/12                     우리은행  2238477  676000000   34808317350  10511800000000  0.33
2018/12/12                    KR모터스    598674  128982090     299935674     64620027090  0.46
2018/12/12                       경방      12961   27415270     136090500    287860335000  0.05
2018/12/12                    메리츠화재   199461  113680000    4308357600   2455488000000  0.18
2018/12/12                    하이트진로   583729   70133611   10390376200   1248378275800  0.83
``` 

market 옵션을 사용하면 코스닥의 공매도 거래량을 조회할 수 있습니다. 사용하지 않을 경우 코스피가 선택됩니다. 
 ```python
df = krx.get_shorting_balance_by_ticker("20181207", "20181212", market="코스닥")
```

ticker 옵션을 사용하면 해당 종목의 거래량만을 조회합니다.
```python
get_shorting_balance_by_ticker("20181112", "20181212", "005930")
```

```text
                          종목명   공매도잔고  상장주식수    공매도금액       시가총액      비중
코스피 (20181112-20181212)                                                                
2018/12/12               삼성전자   4236519  5969782550  171367193550  241477704147500  0.07
2018/12/11               삼성전자   4249549  6419324700  171044347250  258377819175000  0.07
2018/12/10               삼성전자   4728327  6419324700  190078745400  258056852940000  0.07
2018/12/07               삼성전자   4542953  6419324700  186033925350  262871346465000  0.07
2018/12/06               삼성전자   4969285  6419324700  201256042500  259982650350000  0.08
``` 

조회 속도는 조회 기간에 비례해서 증가합니다. (내부적으로 500개씩 데이터를 조회하며, 각각의 조회 후 0.3초 delay 됩니다.)

#### 2.2.5 종목별 공매도 잔고 TOP 50
get_shorting_balance_top50() 메서드는 조회 일자를 입력받아 해당 일의 공매도 잔고 TOp 50을 DataFrame으로 반환합니다.

```python
df = krx.get_shorting_balance_top50("20181212")
print(df)
```

```text
               종목명  순위  잔고수량   상장주식수     잔고금액         시가총액     비중
코스피                                                                              
20181212      삼성전기   1   9728699   74693696  1089614288000   8365693952000  13.02
20181212   두산인프라코어   2  20506916  208157210   161389428920   1638197242700   9.85
20181212      셀트리온   3  10970956  125456133  2484921534000  28415814124500   8.74
20181212      코스맥스   4    650524   10049509    87170216000   1346634206000   6.47
20181212      하나투어   5    604097   11616185    40595318400    780607632000   5.20
20181212   LG디스플레이   6  18555956  357815700   321945836600   6208102395000   5.19
``` 


market 옵션을 사용하면 코스닥의 공매도 거래량을 조회할 수 있습니다. 사용하지 않을 경우 코스피가 선택됩니다. 
 ```python
df = krx.get_shorting_balance_top50("20181212", market="코스닥")
```


### 2.3 채권 API

#### 2.3.1 지표 수익률
```python

```
#### 2.3.2 장외 일자별 채권수익률
```python
df = krx.get_treasury_yields_in_kerb_market("20190208")
```
```text
                       수익률   등락폭
장외 일자별 채권수익률                  
국고채 1년              1.743   -0.008
국고채 3년              1.786   -0.015
국고채 5년              1.853   -0.023
국고채 10년             1.965   -0.030
국고채 20년             2.039   -0.022
국고채 30년             2.034   -0.021
국민주택 1종 5년        1.935   -0.023
회사채 AA-(무보증 3년)  2.234   -0.015
회사채 BBB-(무보증 3년) 8.318   -0.014
CD(91일)                1.860    0.000
``` 