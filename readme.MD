# PyKrx

본 모듈은 KRX (<http://marketdata.krx.co.kr>) 웹 싸이트를 스크래핑 (scraping) 합니다. 
API 사용에 대한 KRX 관리자의 허락을 받지 않은 상태로, API 사용에 대한 책임은 사용자 본인에게 있습니다. 웹싸이트의 스크래핑으로 자신의 영업에 무단 사용하는 것은 불법이기 때문에 개인적인 용도로 사용하셔야 합니다. 또한 도의적으로도 무분별한 API 호출은 자제해 주시기 부탁드립니다.    
결과물은 참고용으로만 사용해야하며, 투자의 결과에 대한 책임은 사용자에게 있습니다. 개인 Study를 진행하며 정리한 내용으로 잘못된 내용이 있을 수 있습니다.  

## 1 환경설정

### 1.1 Installation
pykrx는 pip을 사용해서 쉽게 설치할 수 있습니다. 

```
pip install pykrx
```

### 1.2 Import
모듈의 사용은 import 부터 시작합니다.
<code>from pykrx import *</code>

### 1.3 객체 생성
클래스로 구현되어 있으며, 클래스 객체를 통해 모든 API에 접근할 수있습니다.
```python
krx = Krx()
```
정상적으로 설치가 됐다면 아래 코드가 에러없이 실행됩니다.

```python
krx.get_tickers()
```
###### 실행결과 
```
['060310', '095570', '068400', '006840', '054620', ...]
```        

<br/>

## 2. API 설명

### 2.1 MarketData API


### 2.2 공매도 API
KRX는 (T+2)일 이후의 데이터를 제공한다.   

#### 2.2.1 종목별 공매도 현황 

get_shorting_status_by_date() 메서드는 시작일/종료일/티커 세 개의 파라미터를 입력받아 공매도 현황을 DataFrame으로 반환합니다. 
 
 ```python
df = krx.get_shorting_status_by_date("20181210", "20181212", "005930")
print(df)
```
상환량은 KRX가 제공하지 않으나 잔고와 거래량을 사용해서 계산한 값입니다.
당일 잔고와 (전일 잔고 + 당일 공매도 - 당일 상환) 수량은 정확하게 일치하지 않을 수 있습니다. 
이는 투자자가 보유한 공매도잔고 비율이 상장주식수의 0.01% 미만인 경우 보고의 의무가 없기 때문에 집계되지 않기습니다.  
```text
              공매도     잔고     상환    공매도금액     잔고금액   
삼성전자                                                            
2018/12/12    40002    53032  4236519   1618884450  171367193550
2018/12/11   701924  1180702  4249549  28291624600  171044347250
2018/12/10  2180611        0  4728327  87700923850  190078745400
```

#### 2.2.2 종목별 공매도 거래 현황
get_shorting_volume_by_ticker() 메서드는 시작일/종료일 두 개의 파라미터를 입력받아 해당 기간동안 코스피 종목의 공매도 거래량 정보를 DataFrame으로 반환합니다.


  ```python
df = krx.get_shorting_volume_by_ticker("20181212", "20181212")
print(df)
```
```text
                          종목명    공매도수량  총거래량  거래량비중
코스피(20181212-20181212)                                
2018/12/07                AJ네트웍스      0     26746     0.00
2018/12/07                 AJ렌터카    6901    497586     1.39
```
market 옵션을 사용하면 코스닥의 공매도 거래량을 조회할 수 있습니다. 사용하지 않을 경우 코스피가 선택됩니다. 
 ```python
df = krx.get_shorting_volume_by_ticker("20181212", "20181212", market="코스닥")
print(df)
```
ticker 옵션을 사용하면 특정 종목의 기간 거래량을 조회할 수 있습니다. 사용하지 않을 경우 전체 종목의 거래량을 조회합니다. 
 ```python
df = krx.get_shorting_volume_by_ticker("20181205", "20181212", ticker="005930")
print(df)
```

조회 속도는 조회 기간에 비례해서 증가합니다. (내부적으로 500개씩 데이터를 조회하며, 각각의 조회 후 0.3초 delay 됩니다.)


#### 2.2.3 투자자별 공매도 거래 현황
get_shorting_investor_by_date() 메서드는 시작일/종료일 두 개의 파라미터를 입력받아 해당 기간동안 코스피 종목의 투자자별 공매도 거래량/거래대금을 DataFrame으로 반환합니다.

```python
df = krx.get_shorting_investor_by_date("20181207", "20181212")
print(df)
```

```text
              기관     개인    외국인    기타    합계
거래량-코스피                                              
2018/12/12  1518171  230146  5927886      0   7676203
2018/12/11  1682098  189059  7588421      0   9459578
2018/12/10  2295282  170803  9048100   1415  11515600
2018/12/07  1835771  155753  6126814      0   8118338
```

market 옵션을 사용하면 코스닥의 공매도 거래량을 조회할 수 있습니다. 사용하지 않을 경우 코스피가 선택됩니다. 
 ```python
df = krx.get_shorting_investor_by_date("20181212", "20181212", market="코스닥")
print(df)
```
inquery 옵션을 사용하면 거래대금/거래량을 선택할 수 있습니다. 사용하지 않을 경우 거래량이 선택됩니다. 
 ```python
df = krx.get_shorting_investor_by_date("20181205", "20181212", inquery="거래대금")
print(df)
```

#### 2.2.4 공매도 거래비중 상위 50 종목
get_shorting_trade_top50() 메서드는 조회일자를 입력받아 해당일 코스피 종목의 거래 비중 TOP 50을 DataFrame으로 반환합니다.

```python
df = krx.get_shorting_investor_by_date("20181207", "20181212")
print(df)
```

```text
               순위  공매도거래대금  총거래대금  공매도비중   40일대금평균  대금증가율  40일평균비중 비중증가율  주가수익률
코스피(20181212)                                                                                               
동양생명          1    304432100    454540230   66.976      62246523     4.891       11.882     5.637     1.512
한국토지신탁      2    107461215     319262830   33.659     55167704     1.948        6.994     4.812     1.616
SK디스커버리      3    299738350    1001550500   29.927     70720848     4.238        5.396     5.546     2.679
```

market 옵션을 사용하면 코스닥의 공매도 거래량을 조회할 수 있습니다. 사용하지 않을 경우 코스피가 선택됩니다. 
 ```python
df = krx.get_shorting_investor_by_date("20181207", "20181212", market="코스닥")
```

